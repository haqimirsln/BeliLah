<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Orders | BeliLah</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/pages.css">
    <link rel="stylesheet" href="css/features.css">
</head>
<body>
    <div id="toast" class="toast"></div>
    
    <header class="navbar">
        <nav class="nav-container">
            <div class="nav-logo"><a href="index.html">BeliLah</a></div>
            <ul class="nav-links" id="navLinks">
                <li><a href="index.html">Home</a></li>
                <li><a href="products.html">Products</a></li>
            </ul>
            <div class="nav-actions">
                <a href="wishlist.html" class="icon-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 18C10 18 2 12 2 6.5C2 4.5 3.5 3 5.5 3C7 3 8.5 4 10 5.5C11.5 4 13 3 14.5 3C16.5 3 18 4.5 18 6.5C18 12 10 18 10 18Z" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span class="wishlist-count">0</span>
                </a>
                <a href="cart.html" class="icon-btn cart-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1 1H3L3.4 3M5 11H15L19 3H3.4M5 11L3.4 3M5 11L3 15H17M9 18C9 18.5523 8.55228 19 8 19C7.44772 19 7 18.5523 7 18C7 17.4477 7.44772 17 8 17C8.55228 17 9 17.4477 9 18ZM17 18C17 18.5523 16.5523 19 16 19C15.4477 19 15 18.5523 15 18C15 17.4477 15.4477 17 16 17C16.5523 17 17 17.4477 17 18Z" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
                <div class="user-menu">
                    <div class="user-menu-toggle">
                        <div class="user-avatar">A</div>
                        <span class="user-name">Account</span>
                    </div>
                    <div class="user-dropdown">
                        <a href="account.html" class="user-dropdown-item">
                            <span>üë§</span> My Account
                        </a>
                        <a href="orders.html" class="user-dropdown-item">
                            <span>üì¶</span> My Orders
                        </a>
                        <a href="wishlist.html" class="user-dropdown-item">
                            <span>‚ù§Ô∏è</span> Wishlist
                        </a>
                        <div class="user-dropdown-divider"></div>
                        <div class="user-dropdown-item" onclick="window.authManager.logout()">
                            <span>üö™</span> Logout
                        </div>
                    </div>
                </div>
                <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
            </div>
        </nav>
    </header>

    <section class="page-header">
        <h1>My Orders</h1>
        <p>Track and manage your purchases</p>
    </section>

    <div class="breadcrumb container">
        <a href="index.html">Home</a> <span>/</span> <span>Orders</span>
    </div>

    <section class="cart-page">
        <div class="container" id="ordersContainer"></div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2025 BeliLah. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/products.js"></script>
    <script src="js/cart-manager.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth-manager.js"></script>
    <script src="js/wishlist-manager.js"></script>
    <script src="js/coupon-manager.js"></script>
    <script src="js/review-manager.js"></script>
    <script src="js/ui-components.js"></script>
    
    <script>
    // Check if logged in
    if (!window.authManager.isLoggedIn()) {
        window.location.href = 'index.html';
    }

    function renderOrders() {
        const container = document.getElementById('ordersContainer');
        const user = window.authManager.getUserInfo();
        const orders = user.orders || [];
        
        if (orders.length === 0) {
            container.innerHTML = `
                <div class="cart-empty">
                    <div class="cart-empty-icon">üì¶</div>
                    <h2>No orders yet</h2>
                    <p>Start shopping to see your order history here</p>
                    <a href="products.html" class="btn btn-primary">Browse Products</a>
                </div>
            `;
            return;
        }
        
        container.innerHTML = `
            <div style="margin-bottom: 32px;">
                <h2>${orders.length} ${orders.length === 1 ? 'Order' : 'Orders'}</h2>
            </div>
            <div id="ordersList"></div>
        `;
        
        const ordersList = document.getElementById('ordersList');
        orders.forEach(order => {
            const orderDate = new Date(order.date).toLocaleDateString('en-MY', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const orderCard = document.createElement('div');
            orderCard.className = 'checkout-form';
            orderCard.style.marginBottom = '24px';
            orderCard.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                    <div>
                        <h3 style="font-size: 20px; margin-bottom: 8px;">Order #${order.orderNumber}</h3>
                        <p style="font-size: 14px; color: var(--text-secondary);">
                            Placed on ${orderDate}
                        </p>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 24px; font-weight: 700; color: var(--primary-color);">
                            ${formatCurrency(order.total)}
                        </div>
                        <div style="display: inline-block; padding: 6px 12px; background: #d4edda; color: #155724; border-radius: 6px; font-size: 12px; font-weight: 600; margin-top: 8px;">
                            ‚úì Delivered
                        </div>
                    </div>
                </div>
                
                <div class="user-dropdown-divider" style="margin: 20px 0;"></div>
                
                <h4 style="font-size: 16px; margin-bottom: 16px;">Order Items</h4>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    ${order.items.map(item => `
                        <div style="display: flex; align-items: center; gap: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 12px;">
                            <div style="width: 60px; height: 60px; background: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 32px;">
                                ${item.image}
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600;">${item.name}</div>
                                <div style="font-size: 14px; color: var(--text-secondary);">Qty: ${item.quantity}</div>
                            </div>
                            <div style="font-weight: 700;">${formatCurrency(item.priceValue * item.quantity)}</div>
                        </div>
                    `).join('')}
                </div>
                
                <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="reorderItems('${order.orderNumber}')" style="flex: 1;">
                        Reorder
                    </button>
                    <button class="btn btn-primary" onclick="viewOrderDetails('${order.orderNumber}')" style="flex: 1;">
                        View Details
                    </button>
                </div>
            `;
            ordersList.appendChild(orderCard);
        });
    }

    function reorderItems(orderNumber) {
        const user = window.authManager.getUserInfo();
        const order = user.orders.find(o => o.orderNumber === orderNumber);
        
        if (!order) return;
        
        order.items.forEach(item => {
            const product = window.productsData.getProductById(item.id);
            if (product) {
                window.cartManager.addItem(product, item.quantity);
            }
        });
        
        window.cartManager.showToast('Items added to cart!', 'success');
        setTimeout(() => window.location.href = 'cart.html', 1000);
    }

    function viewOrderDetails(orderNumber) {
        window.location.href = `order-confirmation.html?order=${orderNumber}`;
    }

    renderOrders();
    </script>
</body>
</html>
